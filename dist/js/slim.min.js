/*! Slim.js - v1.0.2 - 2016-12-13
* http://ramon-barros.com/slim.js
* Copyright (c) 2016 Ramon Barros; Licensed MIT */
!function(a){"use strict";var b="undefined"==typeof a,c=!b&&a.localStorage,d={};if(b)return void(module.exports=console);var e=c.andlogKey||"debug";if(c&&c[e]&&a.console)d=a.console;else for(var f="assert,count,debug,dir,dirxml,error,exception,group,groupCollapsed,groupEnd,info,log,markTimeline,profile,profileEnd,time,timeEnd,trace,warn".split(","),g=f.length,h=function(){};g--;)d[f[g]]=h;"undefined"!=typeof exports?module.exports=d:a.console=d}(this),function(a){"use strict";function b(){this.fake=!0,this.boundary="--------FormData"+Math.random(),this._fields=[]}a.FormData||(b.prototype.append=function(a,b){this._fields.push([a,b])},b.prototype.toString=function(){var a=this.boundary,b="";return this._fields.forEach(function(c){if(b+="--"+a+"\r\n",c[1].name){var d=c[1];b+='Content-Disposition: form-data; name="'+c[0]+'"; filename="'+d.name+'"\r\n',b+="Content-Type: "+d.type+"\r\n\r\n",b+=d.getAsBinary()+"\r\n"}else b+='Content-Disposition: form-data; name="'+c[0]+'";\r\n\r\n',b+=c[1]+"\r\n"}),b+="--"+a+"--"},a.FormData=b)}(this),function(a){var b=function(){return this.console=a.console,this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimDebug:__constructor()"),this},b.prototype.caller=function(){var a,b,c,d=/([^\s]+)/g;try{throw new Error}catch(e){b=e.stack,b=b.replace(/(SlimDebug.[^\s]+)/g,""),b=b.replace(/(@http[^\s]+)/g,""),c=b.match(d),a=c.join(" -> ")}return a},b.prototype.assert=function(a){var b=this;this.console.assert("SlimDebug: "+b.caller(),a)},b.prototype.count=function(a){var b=this;this.console.count("SlimDebug: "+b.caller(),a)},b.prototype.debug=function(a){var b=this;this.console.debug("SlimDebug: "+b.caller(),a)},b.prototype.dir=function(a){var b=this;this.console.dir("SlimDebug: "+b.caller(),a)},b.prototype.dirxml=function(a){var b=this;this.console.dirxml("SlimDebug: "+b.caller(),a)},b.prototype.error=function(a){var b=this;this.console.error("SlimDebug: "+b.caller(),a)},b.prototype.exception=function(a){var b=this;this.console.exception("SlimDebug: "+b.caller(),a)},b.prototype.group=function(a){var b=this;this.console.group("SlimDebug: "+b.caller(),a)},b.prototype.groupCollapsed=function(a){var b=this;this.console.groupCollapsed("SlimDebug: "+b.caller(),a)},b.prototype.groupEnd=function(a){var b=this;this.console.groupEnd("SlimDebug: "+b.caller(),a)},b.prototype.info=function(a){var b=this;this.console.info("SlimDebug: "+b.caller(),a)},b.prototype.markTimeline=function(a){var b=this;this.console.markTimeline("SlimDebug: "+b.caller(),a)},b.prototype.log=function(a){var b=this;this.console.log("SlimDebug: "+b.caller(),a)},b.prototype.warn=function(a){var b=this;this.console.warn("SlimDebug: "+b.caller(),a)},a.SlimDebug=new b,b}(this),function(a){"use strict";var b=function(){return this.system="app",this.hash=a.document.location.hash,this.host=a.document.location.host,this.hostname=a.document.location.hostname,this.origin=a.document.location.origin,this.port=a.document.location.port,this.protocol=a.document.location.protocol,this.pathname=a.document.location.pathname,this.search=a.document.location.search,this.baseurl="",this.apiurl="",this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimUrl:__constructor()"),this},b.prototype.setOrigin=function(a){return this.origin=a||this.origin,this},b.prototype.setBase=function(a){return this.baseurl=a,this},b.prototype.setApi=function(a){return this.apiurl=a,this},b.prototype.cleanUri=function(a){return a.replace(/\/+/g,"/").replace(/^\/|\/($|\?)/,"").replace(/#\/?/,"")},b.prototype.baseUrl=function(a){return this.origin+this.baseurl+(a||"")},b.prototype.apiUrl=function(a){return this.origin+this.apiurl+(a||"")},b.prototype.redirect=function(b){a.location.href=b},b.prototype.setSystem=function(a){return this.system=a,this.system},b.prototype.segments=function(a){var b=this.cleanUri(this.pathname),c=String(b).split("/"),d=c.indexOf(this.system)+1;return c=c.slice(d,c.length),void 0!==typeof a?c[a]:c},a.SlimUrl=new b,b}(this),function(a){"use strict";var b=function(){return this.__constructor()};return b.prototype.__constructor=function(){return console.log("EventListener:__constructor()"),this.onhashchange(),this},b.prototype.onhashchange=function(){if("object"!=typeof a.onhashchange){var b=a.location,c=b.href,d=b.hash;setInterval(function(){var e=b.href,f=b.hash;f!==d&&"function"==typeof a.onhashchange&&(a.onhashchange({type:"hashchange",oldURL:c,newURL:e}),c=e,d=f)},100)}},b.prototype.addEvent=function(b,c,d){var e=0;if(a.document.addEventListener){if(b&&b.nodeName||b===a)b.addEventListener(c,d,!1);else if(b&&b.length)for(e;e<b.length;e++)a.EventListener.addEvent(b[e],c,d)}else if(b&&b.nodeName||b===a)b.document.body.attachEvent("on"+c,function(){return d.call(b,a.event,a.EventListener)});else if(b&&b.length)for(e;e<b.length;e++)a.EventListener.addEvent(b[e],c,d)},a.EventListener=new b,b}(this),function(a){"use strict";var b=function(){return this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimExceptions:__constructor()"),this.ajax(),this},b.prototype.jsonResponse=function(a){var b=[];return b[400]="Unrecognized command",b[401]="Permission denied",b[402]="Missing argument",b[401]="Incorrect password",b[404]="Page not found",b[405]="Email not validated",b[408]="Token expired",b[411]="Insufficient privileges",b[500]="Internal server error",b[a]},b.prototype.ajax=function(){var b=this;return $.ajaxSetup({statusCode:{401:function(){$.notify("A sessão foi fechada você será redirecionado para a tela de login!","warn"),setTimeout(function(){a.location.href=a.location.origin},5e3)}}}),$(document).ajaxError(function(a,c,d,e){console.log(a,c,d,e),$.notify("Desculpe, ocorreu um erro inesperado. ["+b.jsonResponse(c.status)+"]","error")}),this},a.SlimExceptions=new b,b}(this),function(a){"use strict";var b=function(){return this.options=null,this.env="local",this.file=null,/localhost/.test(SlimUrl.host)||/192\.168\.1/.test(SlimUrl.host)||/.dev/.test(SlimUrl.host)?a.localStorage.debug=!0:(delete a.localStorage.debug,this.env="prod"),this.setFileOptions(),this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimConfig:__constructor()"),this},b.prototype.setFileOptions=function(a){return this.file=a||"config/"+this.env+".json",this},b.prototype.loadOptions=function(a,b){console.log("SlimConfig:loadOptions");var c=this;return c.options=c.load("app.options"),c.options?(SlimUrl.setBase(c.options.baseUrl),SlimUrl.setApi(c.options.apiUrl),b(c.options)):c.getJsonAsync(c.file).then(function(d){c.options=JSON.parse(d),c.save("app.options",c.options,1200),SlimUrl.setOrigin(c.options.originUrl),SlimUrl.setBase(c.options.baseUrl),SlimUrl.setApi(c.options.apiUrl),b(c.options),a.hooks.after.apply(a)})["catch"](function(a){throw a}),this},b.prototype.getJsonAsync=function(a){return console.log("SlimConfig:getJsonAsync"),new Promise(function(b,c){console.log("SlimConfig:getJsonAsync() > Promise()");var d=new XMLHttpRequest;d.open("GET",a),d.onload=function(){200===d.status?b(d.response):c("Unable to load JSON")},d.onerror=function(){c("Unable to load JSON")},d.send(!0)})},b.prototype.save=function(b,c,d){if("undefined"==typeof Storage)return!1;var e={value:JSON.stringify(c),timestamp:(new Date).getTime()+d};return a.localStorage.setItem(b,JSON.stringify(e)),c},b.prototype.load=function(b){if("undefined"==typeof Storage)return!1;var c=JSON.parse(a.localStorage.getItem(b));return c?(new Date).getTime()<c.timestamp&&JSON.parse(c.value):!1},a.SlimConfig=new b,b}(this),function(a,b){"use strict";var c=function(){return this.data={},this.namespaces={},this.hooks={"before.dispatch":function(){console.log("SlimCore:hook.before.dispatch")},"after.dispatch":function(){console.log("SlimCore:hook.after.dispatch")}},this.__constructor()};return c.prototype.__constructor=function(){return console.log("SlimView:__constructor()"),this},c.prototype.setData=function(a,b){return this.data[a]=b,this},c.prototype.setHook=function(a){return this.hooks["before.dispatch"]=a["before.dispatch"],this.hooks["after.dispatch"]=a["after.dispatch"],this},c.prototype.render=function(a,c,d){var e,f=this;f.data=b.extend({},f.data,c);try{f.hooks["before.dispatch"].apply(f),twig({href:a,async:!d,load:function(a){e=a.render(f.data),d||b(".app").html(e).fadeIn()}}),f.hooks["after.dispatch"].apply(f)}catch(g){console.log(g)}return e},a.SlimView=new c,c}(this,jQuery),function(a){"use strict";var b=function(){return this.routes=[],this.mode=null,this.root=null,this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimRouter:__constructor()"),this.config({mode:"hash"}),this},b.prototype.config=function(a){return this.mode=a&&a.mode&&"history"===a.mode&&history.pushState?"history":"hash",this.root=a&&a.root?"/"+this.clearSlashes(a.root)+"/":"/",this},b.prototype.getFragment=function(){var b="";if("history"===this.mode)b=this.clearSlashes(decodeURI(location.pathname+location.search)),b=b.replace(/\?(.*)$/,""),b="/"!==this.root?b.replace(this.root,""):b;else{var c=a.location.href.match(/#\/(.*)$/);b=c?c[1]:""}return this.clearSlashes(b)},b.prototype.clearSlashes=function(a){return a.toString().replace(/\/$/,"").replace(/^\//,"")},b.prototype.add=function(a,b){return"function"==typeof a&&(b=a,a=""),this.routes.push({re:a,handler:b}),this},b.prototype.remove=function(a){for(var b,c=0;c<this.routes.length;c++)if(b=this.routes[c],b.handler===a||b.re.toString()===a.toString())return this.routes.splice(c,1),this;return this},b.prototype.flush=function(){return this.routes=[],this.mode=null,this.root="/",this},b.prototype.check=function(a){for(var b=a||this.getFragment(),c=0;c<this.routes.length;c++){var d=b.match(this.routes[c].re);if(d)return d.shift(),this.routes[c].handler.apply({},d),this}return this},b.prototype.listen=function(){var a=this,b=a.getFragment(),c=function(){b!==a.getFragment()&&(b=a.getFragment(),a.check(b))};return clearInterval(this.interval),this.interval=setInterval(c,50),this},b.prototype.navigate=function(b){return b=b?b:"","history"===this.mode?history.pushState(null,null,this.root+this.clearSlashes(b)):a.location.href=a.location.href.replace(/#(.*)$/,"")+"#"+b,this},b.prototype.get=function(a,b){this.add(a,b)},a.SlimRouter=new b,b}(this),function(a){"use strict";var b=function(){return this.extensions={router:function(){var a=this;Twig.extendFunction("route",function(b,c){if(a.routes.namespaces.hasOwnProperty(b)){var d=SlimUrl.cleanUri(a.routes.namespaces[b].uri),e=d.split("?",2),f=e[0].split("/",50),g=e[1]?e[1].split("&",50):[],h=a.getParamsFromRouter(d,f,g);Object.getOwnPropertyNames(h).length>0&&Object.getOwnPropertyNames(c).length>0&&$.each(c,function(a,b){h.hasOwnProperty(a)&&(d=d.replace(new RegExp("("+h[a]+")","g"),b))});var i="#/"+(d.length>0?d:"");return i}return"#"})}},this.__constructor()};return b.prototype.__constructor=function(){return console.log("SlimExtensions:__constructor()"),this},b.prototype.addExtension=function(a,b){return console.log("SlimExtensions:addExtension()"),this.extensions[a]=b,this},b.prototype.getExtensions=function(a){return console.log("SlimExtensions:getExtensions()"),a&&this.extensions[a]?this.extensions[a]:this.extensions},b.prototype.run=function(a){console.log("SlimExtensions:run()");var b,c=this.getExtensions();for(b in c)c.hasOwnProperty(b)&&c[b].apply(a)},a.SlimExtensions=new b,a.SlimExtensions}(this),function(a,b){"use strict";var c=function(){return this.view=null,this.router=null,this.options=null,this.params=[],this.routes={},this.routes.get={},this.routes.post={},this.routes.put={},this.routes.patch={},this.routes["delete"]={},this.routes.namespaces={},this.tmp={},this.hooks={before:function(){console.log("SlimCore:hook.before")},"before.router":function(){console.log("SlimCore:hook.before.router")},"before.dispatch":function(){console.log("SlimCore:hook.before.dispatch")},"after.dispatch":function(){console.log("SlimCore:hook.after.dispatch")},"after.router":function(){console.log("SlimCore:hook.after.router")},after:function(){console.log("SlimCore:hook.after")}},this.__constructor()};return c.prototype.__constructor=function(){return console.log("SlimCore:__constructor()"),this.view=SlimView,this.router=SlimRouter,this},c.prototype.setDefaultRouter=function(a){this.defaultRouter=a},c.prototype.setHash=function(b){var c,d,e,f;return"/"===b?c="#/":(b=SlimUrl.cleanUri(b),c="#/"+(b.length>0?b:"")),a.location.hash!==c?a.location.hash=c:this.routes.get.hasOwnProperty(b)?this.routes.get[b].apply(this,this.params):(c=c.replace(/([\?\&]time=[^\&]+)/,""),d=c.split("&"),c=d.shift(),e=d.length>0?"&"+d.join("&"):"",c+=e,f=/\?/.test(c)?"&":"?",a.location.hash=c+(f+"time="+(new Date).getTime())),this},c.prototype.routers=function(){console.log("SlimCore:routers()");var c=this;if(b(document).on("click","[ui-sref], [sm-ref]",function(a){a.preventDefault();var d=b(this).attr("ui-sref")||b(this).attr("sm-ref");console.log("SlimCore:click[ui-sref, sm-ref]["+d+"]"),c.setHash(d)}),b(document).on("submit","form",function(d){console.log("SlimCore:form.submit"),d.stopPropagation(),d.preventDefault();var e="enabled"===(b(this).data("request")||"enabled"),f=b(this).attr("action")||SlimUrl.cleanUri(a.location.hash),g=b(this).attr("enctype"),h=(b(this).find('input[name="_METHOD"]').val()||b(this).attr("method")||"get").toLowerCase(),i=b(this).serialize();if(!c.routes.hasOwnProperty(h))throw"Rota não encontrada["+h+":"+f+"]!";if(!c.routes[h].hasOwnProperty(f))throw"Rota não encontrada ["+h+":"+f+"]!";if(c.params=[],"multipart/form-data"===g&&(i=new FormData(d.target)),e){var j=f.split("?",2),k=j[0].split("/",50),l=i.split("&",50),m=c.getParamsFromRouter(f,k,l);c.request(h,SlimUrl.apiUrl(f),m).done(c.routes[h][f])}else c.params.push(i),c.routes[h][f].apply(c,c.params)}),a.location.hash.length>0){var d=SlimUrl.cleanUri(a.location.hash);c.setHash(d)}else this.defaultRouter&&c.setHash(this.defaultRouter)},c.prototype.getParamsFromRouter=function(a,b,c){var d={},e={},f=a.split("/",50);if(f.length<b.length)return!1;for(var g=0;g<f.length;g++){var h=f[g],i=b[g];if(void 0!==i){if(":"===h.charAt(0)){d[h.substr(1)]=i;continue}if(h!==i)return!1}else{if(":"!==h.charAt(0))return!1;e[h.substr(1)]=!0}}for(var j=0;j<c.length;j++){var k=c[j].split("=",2),l=k[0];2!==k.length||d[l]||e[l]||(d[l]=k[1])}return d},c.prototype.render=function(a,b,c){return this.view.setHook(this.hooks).render(SlimUrl.baseUrl(a),b,c)},c.prototype.redirect=function(b,c){var d=a.SlimCore;if(d.routes.get.hasOwnProperty(b)){d.params=[];for(var e in c)d.params.push(c[e]);d.setHash(b)}},c.prototype.hook=function(b,c){var d=a.SlimCore;return d.hooks.hasOwnProperty(b)&&(d.hooks[b]=c),this},c.prototype.get=function(a,b){return this.tmp.method="get",this.tmp.uri=a,this.routes.get[a.replace(/^\//,"")]=b,this},c.prototype.post=function(a,b){return this.tmp.method="post",this.tmp.uri=a,this.routes.post[a.replace(/^\//,"")]=b,this},c.prototype.put=function(a,b){return this.tmp.method="put",this.tmp.uri=a,this.routes.put[a.replace(/^\//,"")]=b,this},c.prototype.patch=function(a,b){return this.tmp.method="patch",this.tmp.uri=a,this.routes.patch[a.replace(/^\//,"")]=b,this},c.prototype["delete"]=function(a,b){return this.tmp.method="delete",this.tmp.uri=a,this.routes["delete"][a.replace(/^\//,"")]=b,this},c.prototype.submit=function(a){this.request("POST",SlimUrl.apiUrl(""),a)},c.prototype.name=function(a){this.routes.namespaces[a]={name:a,method:this.tmp.method,uri:this.tmp.uri},this.tmp.method=void 0,this.tmp.uri=void 0},c.prototype.request=function(a,c,d,e){console.log("SlimCore:request["+a+"]["+c+"]");var f,g=!(d instanceof FormData),h=d instanceof FormData?!1:"application/x-www-form-urlencoded; charset=UTF-8",i=!1;return f=b.ajax({method:a||"GET",url:c||SlimUrl.apiUrl(),data:d||{},processData:g,contentType:h,dataType:"json",async:e||!0}).done(function(){i&&b.notify("Ok!","success")}).fail(function(){i&&b.notify("Error!","error")}).always(function(){i&&b.notify("Complete!","warn")})},a.SlimCore=new c,EventListener.addEvent(a,"hashchange",function(){var c,d=a.SlimUrl.cleanUri(a.location.hash),e=d.split("?",2),f=e[0].split("/",50),g=e[1]?e[1].split("&",50):[];a.SlimCore.routes.get.hasOwnProperty(d)?a.SlimCore.routes.get[d].apply(a.SlimCore,a.SlimCore.params):(c=!1,b.each(a.SlimCore.routes.get,function(b,d){var e=a.SlimCore.getParamsFromRouter(b,f,g);if(e){a.SlimCore.params=[];for(var h in e)a.SlimCore.params.push(e[h]);c=!0,d.apply(a.SlimCore,a.SlimCore.params)}}),c||(a.location.href="404.html"))}),c}(this,jQuery),function(a){"use strict";var b=function(a){var b={debug:!0,"templates.path":"./views"};return this.version="1.0.2",this.settings=$.extend({},b,a),this.__constructor()};return b.prototype=SlimCore,b.prototype.constructor=b,b.prototype.__constructor=function(){return console.log("Slim:__constructor()"),this},b.prototype.baseUrl=function(a){return SlimUrl.baseUrl(a)},b.prototype.apiUrl=function(a){return SlimUrl.apiUrl(a)},b.prototype.api=function(a){console.log("Slim:api");var b,c,d;switch(a){case"check":b="OPTIONS",c=SlimUrl.apiUrl();break;default:b="OPTIONS",c=SlimUrl.apiUrl()}return this.request(b,c,d)},b.prototype.run=function(){console.log("Slim:run"),SlimExtensions.run(this);var b=this;b.hooks.before.apply(SlimCore),SlimConfig.loadOptions(SlimCore,function(c){b.settings.debug!==!0&&delete a.localStorage.debug,b.options=c,b.hooks["before.router"].apply(SlimCore),b.routers(),b.hooks["after.router"].apply(SlimCore)})},b.prototype.flash=function(a,b,c){return console.log("Slim:flash"),$("form").notify(a,{className:b||"warn",position:c||"top center"}),this},a.Slim=b,a.Slim}(this);